# 專案架構及程式碼功能說明

本專案 **StockWinner AI** 是一個基於 React 的台股智能分析應用程式，集成 Google Gemini API (Flash/Pro 模型) 來提供即時的市場分析、即時法人行為判讀與策略建議。

## 1. 專案概述 (Project Overview)
- **專案名稱**: StockWinner AI (股票贏家)
- **核心目標**: 利用 Generative AI 模擬法人機構的決策邏輯，為使用者提供即時的個股診斷、趨勢判斷與進出場策略。
- **主要特色**:
    - **雙模式分析**: 支援 **Flash (快速掃描)** 與 **Pro (深度推理)** 兩種 AI 模式。
    - **法人行為引擎**: 獨創「佈局、試單、撤退」三階段狀態機分析。
    - **智能緩存**: 實作 LocalStorage 緩存機制，減少 API 消耗並提升載入速度。
    - **動態策略**: AI 自動生成當日熱門題材選股策略。

## 2. 技術架構 (Technical Architecture)

### 前端技術棧 (Frontend Stack)
- **核心框架**: React 19 + TypeScript
- **建置工具**: Vite
- **樣式庫**: Tailwind CSS (使用 Glassmorphism 玻璃擬態設計風格)
- **圖表庫**: Recharts (雷達圖、數據可視化)
- **圖標庫**: Lucide React
- **AI 整合**: Google GenAI SDK (`@google/genai`)

### 系統分層
1.  **View Layer (UI Components)**: 負責畫面渲染與使用者交互 (`components/`).
2.  **Service Layer (Business Logic)**: 負責與 AI 模型溝通、資料處理與緩存邏輯 (`services/`).
3.  **Data Layer (Types)**: 定義強型別的資料結構 (`types.ts`).

## 3. 核心功能模組 (Core Functionality)

### A. 主控台與儀表板 (`Dashboard.tsx`)
- **功能**: 作為應用程式的首頁，展示市場概況與選股清單。
- **資料來源**: 
    - 透過 `geminiService.ts` 的 `getDashboardData` 函式，由 AI 聯網抓取 Yahoo 股市與 CMoney 的即時榜單（熱門、績優、強勢、法人、高殖利率）。
    - **動態策略**: AI 會自動分析當前市場熱點，生成 3 個動態選股策略（例如：CoWoS概念、重電綠能等）。
- **互動設計**: 
    - 支援頁籤切換 (Tabs)。
    - 最近搜尋紀錄 (History) 儲存於 LocalStorage。
    - 股票代號搜尋欄。

### B. 個股深度分析 (`StockDetail.tsx`)
- **功能**: 展示單一個股的詳細 AI 診斷報告。
- **視覺化呈現**:
    - **法人行為階段**: 使用狀態機 (State Machine) 視覺化目前的籌碼狀態（🟢佈局 / 🟡試單 / 🔴撤退）。
    - **三大面向雷達圖**: 基本面、技術面、籌碼面的評分 (0-100) 與雷達圖展示。
    - **市場情緒與散戶指標**: 分析新聞輿情與融資券變化。
- **交易策略 (Trade Setup)**:
    - AI 給出明確的 Action (買進/賣出/觀望)。
    - 計算 **進場區間**、**目標價** 與 **停損點**。
    - 提供 **成功機率** 與 **預期持有時間**。

### C. AI 核心服務 (`services/geminiService.ts`)
這是整個專案的「大腦」，負責與 Google Gemini 互動。

1.  **`analyzeStock(symbol, mode)`**:
    - **Prompt Engineering**: 使用 "Professional Institutional Data Scientist" 人設。
    - **Structured Output**: 強制 AI 輸出符合 `AIAnalysisResult` 介面的 JSON 格式。
    - **Thinking Mode (Pro)**: 若選擇 Pro 模式，會啟用 Thinking Config (Budget: 20000 tokens) 進行深度推理。
    - **Caching**: 針對代號與模式進行緩存 (30分鐘效期)，避免重複 API 呼叫。

2.  **`getDashboardData()`**:
    - 平行執行兩個 AI 請求：獲取 Yahoo/CMoney 榜單、生成動態策略。
    - 緩存效期設定為 15 分鐘。

## 4. 檔案結構說明 (File Structure)

```
StockAI/
├── App.tsx                 # 應用程式入口，處理路由 (Dashboard <-> Detail) 與全域狀態
├── types.ts                # 定義所有 TypeScript 介面 (StockMetadata, AIAnalysisResult 等)
├── components/             # UI 元件庫
│   ├── Dashboard.tsx       # 首頁：市場榜單與搜尋
│   ├── StockDetail.tsx     # 詳細頁：個股分析報告
│   └── RadialChart.tsx     # 共用元件：環形進度圖表
├── services/
│   └── geminiService.ts    # AI 服務層：封裝 Google GenAI API 呼叫與緩存邏輯
├── index.css               # Tailwind CSS 全域樣式設定
└── vite.config.ts          # Vite 設定檔
```

## 5. 資料流向 (Data Flow)

1.  **使用者操作**: 在 `App.tsx` 或 `Dashboard.tsx` 輸入股票代號 (如 2330)。
2.  **服務呼叫**: 呼叫 `geminiService.analyzeStock('2330', mode)`。
3.  **緩存檢查**: 檢查 LocalStorage 是否有 30 分鐘內的有效資料。
    - **有**: 直接回傳。
    - **無**: 構建 Prompt -> 傳送至 Google Gemini API -> 接收 JSON -> 寫入緩存。
4.  **狀態更新**: `App.tsx` 接收資料，設定 `AnalysisStatus.SUCCESS`。
5.  **畫面渲染**: 切換顯示 `StockDetail` 元件，將數據視覺化呈現。
